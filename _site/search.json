[
  {
    "objectID": "walker.data.com.html",
    "href": "walker.data.com.html",
    "title": "walker.data.com",
    "section": "",
    "text": "if (!requireNamespace('arrow'))     \n  install.packages('arrow', \n    repos = 'https://apache.r-universe.dev')\nlibrary(arrow) \n# first load arrow then, _if_ needed, run install_arrow()\narrow_info() |&gt; names()\narrow_info()$capabilities |&gt; sort()\narrow_info()$build_info$cpp_version\narrow_info()$build_info$cpp_compiler\nstopifnot(\n    arrow_available()\n  , arrow_with_s3()\n  , arrow_with_parquet()\n  , arrow_with_json()\n  , arrow_with_dataset()\n  , arrow_with_gcs()\n  # arrow_with_acero() , arrow_with_substrait()\n)\nif (!requireNamespace('rdeck')) \n  pak::pak(\"qfes/rdeck\")\n# remotes::install_github(\"qfes/rdeck\")\nif (!requireNamespace('pacman')) \n  install.packages(\"pacman\")\npacman::p_load(\n  sf, dplyr, tigris, rdeck,\n  scales, tictoc, lobstr)\noptions(tigris_use_cache = TRUE)\n\n\ns3_buildings &lt;- \n  's3://overturemaps-us-west-2/release/2024-05-16-beta.0/theme=buildings?region=us-west-2'\ntic('open_dataset')\n  # database-like connection to the buildings dataset\n  buildings &lt;- open_dataset(s3_buildings)\ntoc()\nlobstr::obj_size(buildings)\n\n\ntic('nrow(buildings)')\n  num_buildings &lt;- nrow(buildings) \ntoc()\nnum_buildings |&gt; prettyNum(big.mark = ',')\nnum_buildings |&gt; \n  scales::label_number(accuracy=0.1, \n    scale_cut=scales::cut_short_scale())(x = _)\n\n\n\n\nWide {{bbox|-0.489|51.28|0.236|51.686}}\nhttps://www.openstreetmap.org/export#map=15/51.5150/-0.0912\n\nldn_bb &lt;- c(-0.1061, 51.5227, -0.0763, 51.5072)\n\nhttp://bboxfinder.com/#0.000000,0.000000,0.000000,0.000000\n\n-0.120450,51.509507,-0.076247,51.526465\n\n\n\nldn_bbox &lt;- c(-0.1061, 51.5227, -0.0763, 51.5072)\nget_buildings &lt;- function(bbox, buildings){\n  buildings |&gt;\n  # Filter expression not supported for Arrow Datasets\n  # collect() |&gt; \n  filter(bbox$xmin &gt; bbox[1],\n         bbox$ymin &gt; bbox[2],\n         bbox$xmax &lt; bbox[3],\n         bbox$ymax &lt; bbox[4]) |&gt;\n  select(id, geometry, height) |&gt; \n  collect() |&gt;\n  st_as_sf(crs = 4326) |&gt; \n  mutate(height = ifelse(is.na(height), 8, height))\n}\nldn_buildings &lt;- \n  ldn_bbox |&gt; \n  get_buildings(buildings)\n\n\nrdeck(map_style = mapbox_light(), \n      initial_view_state = view_state(\n        center = c(-122.4657, 37.7548),\n        zoom = 11.3,\n        bearing = -60,\n        pitch = 76\n      )) |&gt; \n  add_polygon_layer(\n    data = ldn_buildings, \n    name = \"London (central)\",\n    get_polygon = geometry, \n    get_elevation = height, \n    get_fill_color = scale_color_linear(\n      col = height,\n      palette = viridisLite::inferno(100, direction = -1)\n    ),\n    extruded = TRUE, \n    opacity = 0.5)\n\n\n\n\n\nsf_bbox &lt;- counties(state = \"CA\", cb = TRUE, resolution = \"20m\") |&gt; \n  filter(NAME == \"San Francisco\") |&gt; \n  st_bbox() |&gt; \n  as.vector()\nsf_buildings &lt;- \n  sf_bbox |&gt; \n  get_buildings(buildings)\nsf_buildings_old &lt;- buildings |&gt;\n  filter(bbox$xmin &gt; sf_bbox[1],\n         bbox$ymin &gt; sf_bbox[2],\n         bbox$xmax &lt; sf_bbox[3],\n         bbox$ymax &lt; sf_bbox[4]) |&gt;\n  select(id, geometry, height) |&gt; \n  collect() |&gt;\n  st_as_sf(crs = 4326) |&gt; \n  mutate(height = ifelse(is.na(height), 8, height))\nsf_buildings |&gt; identical(sf_buildings_old)\n\n\nrdeck(map_style = mapbox_light(), \n      initial_view_state = view_state(\n        center = c(-122.4657, 37.7548),\n        zoom = 11.3,\n        bearing = -60,\n        pitch = 76\n      )) |&gt; \n  add_polygon_layer(\n    data = sf_buildings, \n    name = \"San Francisco\",\n    get_polygon = geometry, \n    get_elevation = height, \n    get_fill_color = scale_color_linear(\n      col = height,\n      palette = viridisLite::inferno(100, direction = -1)\n    ),\n    extruded = TRUE, \n    opacity = 0.5)"
  },
  {
    "objectID": "walker.data.com.html#london",
    "href": "walker.data.com.html#london",
    "title": "walker.data.com",
    "section": "",
    "text": "Wide {{bbox|-0.489|51.28|0.236|51.686}}\nhttps://www.openstreetmap.org/export#map=15/51.5150/-0.0912\n\nldn_bb &lt;- c(-0.1061, 51.5227, -0.0763, 51.5072)\n\nhttp://bboxfinder.com/#0.000000,0.000000,0.000000,0.000000\n\n-0.120450,51.509507,-0.076247,51.526465\n\n\n\nldn_bbox &lt;- c(-0.1061, 51.5227, -0.0763, 51.5072)\nget_buildings &lt;- function(bbox, buildings){\n  buildings |&gt;\n  # Filter expression not supported for Arrow Datasets\n  # collect() |&gt; \n  filter(bbox$xmin &gt; bbox[1],\n         bbox$ymin &gt; bbox[2],\n         bbox$xmax &lt; bbox[3],\n         bbox$ymax &lt; bbox[4]) |&gt;\n  select(id, geometry, height) |&gt; \n  collect() |&gt;\n  st_as_sf(crs = 4326) |&gt; \n  mutate(height = ifelse(is.na(height), 8, height))\n}\nldn_buildings &lt;- \n  ldn_bbox |&gt; \n  get_buildings(buildings)\n\n\nrdeck(map_style = mapbox_light(), \n      initial_view_state = view_state(\n        center = c(-122.4657, 37.7548),\n        zoom = 11.3,\n        bearing = -60,\n        pitch = 76\n      )) |&gt; \n  add_polygon_layer(\n    data = ldn_buildings, \n    name = \"London (central)\",\n    get_polygon = geometry, \n    get_elevation = height, \n    get_fill_color = scale_color_linear(\n      col = height,\n      palette = viridisLite::inferno(100, direction = -1)\n    ),\n    extruded = TRUE, \n    opacity = 0.5)"
  },
  {
    "objectID": "walker.data.com.html#sf",
    "href": "walker.data.com.html#sf",
    "title": "walker.data.com",
    "section": "",
    "text": "sf_bbox &lt;- counties(state = \"CA\", cb = TRUE, resolution = \"20m\") |&gt; \n  filter(NAME == \"San Francisco\") |&gt; \n  st_bbox() |&gt; \n  as.vector()\nsf_buildings &lt;- \n  sf_bbox |&gt; \n  get_buildings(buildings)\nsf_buildings_old &lt;- buildings |&gt;\n  filter(bbox$xmin &gt; sf_bbox[1],\n         bbox$ymin &gt; sf_bbox[2],\n         bbox$xmax &lt; sf_bbox[3],\n         bbox$ymax &lt; sf_bbox[4]) |&gt;\n  select(id, geometry, height) |&gt; \n  collect() |&gt;\n  st_as_sf(crs = 4326) |&gt; \n  mutate(height = ifelse(is.na(height), 8, height))\nsf_buildings |&gt; identical(sf_buildings_old)\n\n\nrdeck(map_style = mapbox_light(), \n      initial_view_state = view_state(\n        center = c(-122.4657, 37.7548),\n        zoom = 11.3,\n        bearing = -60,\n        pitch = 76\n      )) |&gt; \n  add_polygon_layer(\n    data = sf_buildings, \n    name = \"San Francisco\",\n    get_polygon = geometry, \n    get_elevation = height, \n    get_fill_color = scale_color_linear(\n      col = height,\n      palette = viridisLite::inferno(100, direction = -1)\n    ),\n    extruded = TRUE, \n    opacity = 0.5)"
  }
]